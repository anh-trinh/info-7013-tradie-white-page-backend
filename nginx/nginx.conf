server {
    listen 80;
    server_name localhost;

    # MPA pages served from host (e.g., Laravel app on port 8000)
    location ~ ^/(search|tradie|login|register|admin/login|$) {
        proxy_pass http://host.docker.internal:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # SPA (Vite/React) on host port 5173
    location ~ ^/(dashboard|tradie-dashboard|admin)(/|$) {
        proxy_pass http://host.docker.internal:5173;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # Booking service
    location ^~ /api/bookings {
        proxy_pass http://booking-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    location ^~ /api/quotes {
        proxy_pass http://booking-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Notification service
    location ^~ /api/notifications {
        proxy_pass http://notification-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Review service
    location /api/reviews/ {
        proxy_pass http://review-service:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    location /api/admin/reviews/ {
        proxy_pass http://review-service:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Account service
    location /api/accounts/ {
        proxy_pass http://account-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    location /api/admin/accounts/ {
        proxy_pass http://account-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Tradie service
    location /api/tradies {
        proxy_pass http://tradie-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    location /api/services {
        proxy_pass http://tradie-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    location /api/admin/categories {
        proxy_pass http://tradie-service:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
